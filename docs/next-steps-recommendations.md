# 文件类型支持现状与下一步建议

## 一、当前支持的文件类型总结

### ✅ 已完全支持（有专门解析器）

| 文件类型 | 解析器 | 目录提取 | 表格提取 | 状态 |
|---------|--------|---------|---------|------|
| **PDF** | `PdfService` | ✅ | ✅ | 完整支持 |
| **DOCX** | `DocxService` | ✅ | ✅ | 完整支持 |
| **XLSX/Excel** | `ExcelService` | ❌ | ✅ | 完整支持（表格类型） |
| **TXT** | `TxtService` | ❌ | ❌ | 完整支持 |
| **MD/Markdown** | `MarkdownService` | ✅ | ✅ | 完整支持 |

### ⚠️ 部分支持（验证通过但无专门解析器）

| 文件类型 | 验证 | 当前处理方式 | 建议 |
|---------|------|-------------|------|
| **PPTX** | ✅ | 可能走 Office 转换 | 需要专门的 `PptxService` |
| **HTML** | ✅ | 作为文本处理 | 需要专门的 `HtmlService` 提取结构化内容（✅ 设计文档已完成） |
| **CSV** | ✅ | 通过 `ExcelService` | ✅ 已支持 |
| **JSON** | ✅ | 作为文本处理 | 需要专门的 `JsonService` 提取结构化数据 |
| **XML** | ✅ | 作为文本处理 | 需要专门的 `XmlService` 提取结构化数据 |

### 📊 支持情况统计

- **已实现解析器**: 5 种（PDF, DOCX, Excel, TXT, MD）
- **验证通过但无专门解析**: 5 种（PPTX, HTML, CSV, JSON, XML）
- **总计**: 10 种文件类型

---

## 二、下一步建议（优先级排序）

### 🔥 **优先级 1：完善现有支持类型**

#### 1.1 实现 PPTX 解析器（`PptxService`）
- **理由**: 已通过验证，但缺少专门解析器
- **技术方案**: 
  - 使用 `python-pptx` 库提取文本和表格
  - 提取每页/每节的结构化内容
  - 支持目录提取（如果有）
- **预计工作量**: 中等（参考 `DocxService`）

#### 1.2 实现 HTML 解析器（`HtmlService`）✅ 设计文档已完成
- **理由**: HTML 有丰富的结构化内容，不应作为纯文本处理
- **技术方案**:
  - 使用 `BeautifulSoup4` 或 `lxml` 解析 HTML
  - 提取标题层级（`<h1>~<h6>`）
  - 提取表格、列表、链接
  - 去除 `<script>`, `<style>` 等无用标签
- **预计工作量**: 中等
- **设计文档**: `docs/basicfunction/html-upload-plan.md`

#### 1.3 实现 JSON 解析器（`JsonService`）
- **理由**: JSON 是结构化数据，应该提取键值对和嵌套结构
- **技术方案**:
  - 解析 JSON 结构
  - 提取键值对作为可检索内容
  - 支持数组和嵌套对象
  - 保留数据类型信息到 metadata
- **预计工作量**: 较小

#### 1.4 实现 XML 解析器（`XmlService`）
- **理由**: XML 也是结构化数据，应提取标签和属性
- **技术方案**:
  - 使用 `xml.etree.ElementTree` 或 `lxml`
  - 提取标签名、属性、文本内容
  - 保留层级结构
  - 支持命名空间
- **预计工作量**: 较小

---

### 🚀 **优先级 2：支持更多文件类型**

#### 2.1 支持旧版 Office 格式
- **DOC** (Word 2003): 使用 `python-docx` 的兼容模式或 `antiword`
- **PPT** (PowerPoint 2003): 使用 `python-pptx` 兼容模式
- **XLS** (Excel 2003): 已通过 `ExcelService` 支持（`xlrd`）

#### 2.2 支持其他常见格式
- **RTF** (Rich Text Format): 使用 `striprtf` 或 `pyth`
- **ODT** (OpenDocument Text): 使用 `odfpy` 或通过 LibreOffice 转换
- **EPUB**: 使用 `ebooklib` 提取章节和文本

#### 2.3 支持代码文件（可选）
- **代码文件类型**: `.py`, `.js`, `.java`, `.cpp`, `.go`, `.rs` 等
- **特点**: 提取函数、类、注释等结构化信息
- **实现**: 使用 AST 解析器（如 `ast` 模块用于 Python）

---

### ⚡ **优先级 3：性能与体验优化**

#### 3.1 批量上传优化
- **当前状态**: 支持单个文件上传
- **建议**: 
  - 支持多文件批量上传（ZIP 压缩包）
  - 上传进度条
  - 断点续传

#### 3.2 预览功能增强
- **当前支持**: PDF、Office（PDF/HTML 预览）、图片、文本、Markdown
- **建议扩展**:
  - JSON/XML 格式化预览
  - CSV 表格可视化预览
  - 代码文件语法高亮预览

#### 3.3 处理性能优化
- **异步处理**: ✅ 已有（Celery）
- **建议**:
  - 大文件分片处理
  - 并行解析多个文档
  - 缓存解析结果

---

### 🎯 **优先级 4：高级功能**

#### 4.1 文档关联分析
- 提取文档之间的引用关系
- 构建知识图谱
- 推荐相关文档

#### 4.2 智能标签生成
- 基于文档内容自动生成标签
- 使用 LLM 提取关键词和摘要

#### 4.3 多语言支持增强
- 检测文档语言
- 多语言混合文档支持
- 语言特定的解析优化

#### 4.4 文档版本对比
- 可视化文档变更
- 差异高亮显示
- 变更统计

---

### 🔧 **优先级 5：系统优化**

#### 5.1 错误处理与重试机制
- 更详细的错误日志
- 自动重试失败的处理任务
- 错误恢复策略

#### 5.2 监控与告警
- 文档处理成功率监控
- 处理时间分析
- 异常告警

#### 5.3 数据一致性保障
- 定期一致性检查
- 自动修复机制
- 数据备份策略

---

## 三、推荐实施路线图

### **第一阶段（1-2周）**: 完善现有类型
1. ✅ 实现 `PptxService` - 支持 PPTX 文件完整解析
2. ✅ 实现 `HtmlService` - 结构化提取 HTML 内容
3. ✅ 实现 `JsonService` - 提取 JSON 结构化数据

### **第二阶段（2-3周）**: 扩展新类型
1. ✅ 支持 DOC/PPT 旧版 Office 格式
2. ✅ 实现 `XmlService`
3. ✅ 支持 RTF 格式

### **第三阶段（持续优化）**: 性能与体验
1. 批量上传功能
2. 预览功能增强
3. 处理性能优化

---

## 四、技术债务与注意事项

### 需要关注的问题

1. **文件大小限制**: 当前可能对超大文件（>100MB）处理不够优化
2. **内存占用**: 某些文件类型（如 Excel）可能占用大量内存
3. **解析错误处理**: 需要更robust的错误处理机制
4. **测试覆盖**: 需要为每种文件类型添加单元测试和集成测试

### 建议优先处理

根据使用频率和业务价值，建议**优先实现 PPTX 和 HTML 解析器**，因为：
- PPTX: 商业文档中常见
- HTML: Web 内容提取需要

JSON/XML 解析器相对简单，可以快速实现，带来结构化数据提取的收益。

---

## 五、结论

当前系统已经支持了**10种文件类型**，其中**5种有完整的解析器**。建议下一步：

1. **短期**（1个月）: 完善 PPTX、HTML、JSON、XML 解析器
2. **中期**（2-3个月）: 支持更多文件类型（DOC、PPT、RTF等）
3. **长期**（持续）: 性能优化、用户体验提升、高级功能开发

**推荐首先实现 PPTX 和 HTML 解析器**，这两个对业务价值最高。

