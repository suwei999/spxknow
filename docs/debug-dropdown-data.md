# 下拉框数据加载问题诊断指南

## 问题描述
手动诊断对话框中的所有下拉框都没有数据显示。

## 诊断步骤

### 1. 打开浏览器开发者工具
- 按 `F12` 打开开发者工具
- 切换到 `Console`（控制台）标签

### 2. 打开手动诊断对话框
点击"手动诊断"按钮，观察控制台输出：

#### 集群列表加载
应该看到以下日志：
```
[DEBUG] 集群列表API响应: {...}
[DEBUG] 集群列表数据: {list: [...], total: 0, ...}
[DEBUG] 解析后的集群列表: [...]
```

**问题排查**：
- 如果看到 `[ERROR] 加载集群失败:` → 检查后端API是否正常，网络请求是否成功
- 如果 `[DEBUG] 解析后的集群列表: []` → 说明后端返回了空列表，检查数据库中是否有集群配置
- 如果没有任何日志 → 检查 `loadClusters` 函数是否被调用

#### 命名空间加载
应该看到以下日志：
```
[DEBUG] 开始加载命名空间，集群ID: 1
[DEBUG] 命名空间API响应: {...}
[DEBUG] 命名空间是数组格式: [...] 或 [DEBUG] 命名空间在list字段中: [...]
[DEBUG] 解析后的命名空间列表: [...]
[DEBUG] 自动选择命名空间: default
```

**问题排查**：
- 如果看到 `[ERROR] 加载命名空间失败:` → 检查后端API调用，可能是K8s API连接问题
- 如果看到 `[WARN] 无法识别的命名空间数据格式:` → 说明后端返回格式不对，检查后端代码
- 如果 `[DEBUG] 解析后的命名空间列表: []` → 检查后端是否正确获取了命名空间

#### 资源列表加载
应该看到以下日志：
```
[DEBUG] 开始加载资源列表，集群ID: 1 资源类型: pods 命名空间: default
[DEBUG] 资源查询参数: {...}
[DEBUG] 资源列表API响应: {...}
[DEBUG] 资源快照列表: [...]
[DEBUG] 解析后的资源名称列表: [...]
```

**问题排查**：
- 如果看到 `[ERROR] 加载资源列表失败:` → 检查后端API调用
- 如果看到 `[DEBUG] 资源快照列表: []` → 说明数据库中没有资源快照，需要先同步资源

### 3. 检查网络请求
在开发者工具的 `Network`（网络）标签中：

1. **检查 `/api/observability/clusters` 请求**
   - 状态码应该是 `200`
   - 响应格式应该是：
     ```json
     {
       "code": 0,
       "message": "ok",
       "data": {
         "list": [...],
         "total": 0,
         "page": 1,
         "size": 10
       }
     }
     ```

2. **检查 `/api/observability/clusters/{id}/namespaces` 请求**
   - 状态码应该是 `200`
   - 响应格式应该是：
     ```json
     {
       "code": 0,
       "message": "ok",
       "data": ["default", "kube-system", ...]
     }
     ```
   - 如果状态码是 `500`，可能是K8s API连接问题

3. **检查 `/api/observability/clusters/{id}/resources` 请求**
   - 状态码应该是 `200`
   - 响应格式应该是：
     ```json
     {
       "code": 0,
       "message": "ok",
       "data": {
         "list": [...],
         "total": 0,
         "page": 1,
         "size": 200
       }
     }
     ```

### 4. 常见问题及解决方案

#### 问题1: 集群列表为空
**原因**：数据库中没有任何集群配置
**解决**：在"集群接入"标签页中添加集群配置

#### 问题2: 命名空间列表为空
**原因**：
- 集群配置不正确（API Server地址、认证信息等）
- K8s API无法连接
- 集群确实没有命名空间

**解决**：
- 检查集群配置是否正确
- 点击集群的"测试"按钮测试连通性
- 检查后端日志是否有错误信息

#### 问题3: 资源列表为空
**原因**：数据库中没有资源快照数据
**解决**：
1. 在"资源快照"标签页中
2. 选择集群和资源类型
3. 点击"手动同步"按钮同步资源

#### 问题4: API请求失败
**原因**：
- 后端服务未启动
- 网络问题
- 认证问题

**解决**：
- 检查后端服务是否运行
- 检查API地址配置是否正确（`VITE_API_BASE_URL`）
- 检查是否需要登录认证

### 5. 后端日志检查
查看后端日志文件 `logs/app.log`，搜索：
- `获取命名空间失败` → K8s API连接问题
- `获取集群配置` → 数据库查询问题
- `获取资源快照` → 资源同步问题

## 快速修复检查清单

- [ ] 检查浏览器控制台是否有错误日志
- [ ] 检查网络请求是否成功（状态码200）
- [ ] 检查后端返回的数据格式是否正确
- [ ] 检查数据库中是否有集群配置
- [ ] 检查集群配置是否正确（API Server、认证信息）
- [ ] 检查是否需要先同步资源
- [ ] 检查后端服务是否正常运行

## 下一步
如果按照以上步骤排查后仍然无法解决问题，请提供：
1. 浏览器控制台的完整日志
2. 网络请求的详细信息（请求URL、响应内容）
3. 后端日志中的错误信息

