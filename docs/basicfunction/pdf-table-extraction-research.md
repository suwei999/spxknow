# PDF 表格识别方案调研报告（仅开源方案）

> **说明**: 本文档仅调研和推荐开源方案，不考虑商业 API 或付费服务。

## 当前使用的方案

### 现有工具
- **pdfplumber**: 基于线条和对齐的视觉识别
- **Camelot**: 支持 lattice（有边框）和 stream（无边框）模式
- **验证逻辑**: 自定义的 `_table_has_data()` 函数

### 当前方案的局限性
1. **准确率**: 约 70-90%，取决于 PDF 质量
2. **无边框表格**: 容易漏检
3. **复杂表格**: 可能拆分或合并错误
4. **扫描件**: 需要先 OCR，准确率进一步下降

---

## 业界主流方案对比

### 1. 传统视觉识别方案（当前使用）

#### pdfplumber
- **优点**: 
  - 轻量级，速度快
  - 对原生 PDF 效果好
  - 支持多种检测策略
- **缺点**: 
  - 依赖线条和对齐
  - 无边框表格识别差
  - 复杂表格容易出错

#### Camelot
- **优点**: 
  - 专门针对表格设计
  - 支持 lattice 和 stream 模式
  - 可以处理无边框表格
- **缺点**: 
  - 需要安装 Ghostscript
  - 对扫描件支持差
  - 参数调优复杂

#### Tabula-py
- **优点**: 
  - 基于 Tabula（Java）的 Python 封装
  - 对简单表格效果好
  - 支持手动选择区域
- **缺点**: 
  - 需要 Java 环境
  - 对复杂表格支持有限
  - 维护不活跃

**准确率**: 70-85%（原生 PDF），50-70%（扫描件）

---

### 2. 深度学习方案（推荐）

#### MinerU ⭐ 新发现
- **技术**: 基于视觉语言模型（Vision-Language Model）的文档解析
- **GitHub**: https://github.com/opendatalab/MinerU (49.4k stars)
- **优点**: 
  - 开源，活跃维护
  - 专门为 LLM 工作流设计（输出 markdown/JSON）
  - 支持复杂文档布局分析
  - 有 Docker 部署方案
  - 支持命令行、API、WebUI 多种使用方式
  - 中文支持好（有中文文档）
  - 在 OmniDocBench 基准测试中表现优秀
- **缺点**: 
  - **表格识别仍有问题**（官方已知问题：复杂表格可能出现行列识别错误）
  - AGPL-3.0 许可证（可能对商业使用有限制）
  - 需要 GPU 或高性能 CPU
  - 模型较大（需要 20GB 磁盘空间）
  - 对垂直文本支持有限
  - 代码块识别还不支持
- **适用场景**: 
  - 需要整体文档解析（不仅仅是表格）
  - 需要输出 LLM 就绪格式（markdown/JSON）
  - 有 GPU 资源
  - 可以接受 AGPL 许可证
- **评估**: 
  - ✅ **整体文档解析能力强**，适合需要完整文档结构提取的场景
  - ⚠️ **表格识别不是其强项**，官方也承认复杂表格有问题
  - ⚠️ **许可证限制**，AGPL 要求衍生作品也开源

#### TableNet / Table Transformer
- **技术**: 基于 Transformer 的表格检测和结构识别
- **优点**: 
  - 准确率高（90%+）
  - 能处理复杂表格
  - 支持无边框表格
- **缺点**: 
  - 需要 GPU
  - 模型较大（几百MB）
  - 推理速度较慢
- **适用场景**: 高准确率要求，有 GPU 资源

#### PaddleOCR PP-Structure
- **技术**: 百度 PaddleOCR 的表格识别模块
- **优点**: 
  - 中文支持好
  - 准确率高（85-95%）
  - 支持表格结构识别
  - 有预训练模型
  - **支持 CPU 和 GPU 两种模式**
- **缺点**: 
  - 模型较大
  - CPU 模式速度较慢
  - 依赖 PaddlePaddle
- **硬件要求**:
  - **GPU 模式（推荐）**:
    - 显存: **至少 6GB**（推荐 8GB+）
    - 示例: NVIDIA RTX 3090（6GB 显存占用，GPU 利用率约 70%）
    - 速度: **约 0.15 秒/页**（A4 图片，300DPI）
    - 性能: 比 CPU 快 **8-10 倍**
  - **CPU 模式（可用但不推荐）**:
    - CPU: 高性能 CPU（如 Intel i9-12900K）
    - 速度: **约 1.2 秒/页**（A4 图片，300DPI）
    - CPU 利用率: 接近 100%
    - 适用场景: 小批量处理、测试环境、无 GPU 资源
- **适用场景**: 中文文档，需要高准确率
- **参考**: [PaddleOCR GitHub](https://github.com/PaddlePaddle/PaddleOCR)

#### TableNet (MIND Research)
- **技术**: 端到端表格检测和识别
- **优点**: 
  - 准确率高
  - 支持复杂表格
- **缺点**: 
  - 需要 GPU
  - 模型较大
- **适用场景**: 企业级应用

#### DETR (Detection Transformer)
- **技术**: Facebook 的目标检测模型，可用于表格检测
- **优点**: 
  - 准确率高
  - 支持端到端训练
- **缺点**: 
  - 需要大量标注数据
  - 训练成本高
- **适用场景**: 有标注数据，需要定制化

**准确率**: 85-95%（原生 PDF），75-90%（扫描件）

---

### 4. 混合方案（推荐用于生产环境）

#### 方案 A: 多工具投票机制
```
1. 同时使用 pdfplumber、Camelot、Tabula 检测
2. 对检测结果进行投票或融合
3. 选择置信度最高的结果
```
- **优点**: 提高准确率，降低误检
- **缺点**: 处理时间增加 2-3 倍

#### 方案 B: 分层检测
```
1. 先用轻量级工具（pdfplumber）快速检测
2. 对不确定的区域，使用深度学习模型（PP-Structure）验证
3. 对扫描件，先 OCR 再检测
```
- **优点**: 平衡速度和准确率
- **缺点**: 需要集成多个工具

#### 方案 C: 预处理 + 深度学习
```
1. PDF 转图片（高分辨率）
2. 图像预处理（去噪、校正）
3. 使用深度学习模型检测表格
4. OCR 识别表格内容
```
- **优点**: 准确率最高
- **缺点**: 处理时间最长

---

## 方案推荐（按场景）

### 场景 1: 原生 PDF，简单表格，对速度要求高
**推荐**: 当前方案（pdfplumber + Camelot）+ 优化参数
- **准确率**: 75-85%
- **速度**: 快（<1秒/页）
- **成本**: 低

### 场景 2: 原生 PDF，复杂表格，对准确率要求高
**推荐**: PaddleOCR PP-Structure
- **准确率**: 85-95%
- **速度**: 
  - GPU 模式: **0.15 秒/页**（推荐，需要 6GB+ 显存）
  - CPU 模式: **1.2 秒/页**（可用，需要高性能 CPU）
- **成本**: 
  - GPU 模式: 中等（需要 GPU，6GB+ 显存）
  - CPU 模式: 低（仅需高性能 CPU，无需 GPU）
- **选择建议**:
  - 有 GPU 资源: 使用 GPU 模式（速度快 8-10 倍）
  - 无 GPU 资源: 使用 CPU 模式（可用，但速度较慢）

### 场景 3: 扫描件 PDF，对准确率要求高
**推荐**: 预处理 + PaddleOCR PP-Structure
- **准确率**: 80-90%
- **速度**: 慢（5-10秒/页）
- **成本**: 中等

### 场景 4: 需要完整文档解析（不仅仅是表格），输出 LLM 就绪格式
**推荐**: MinerU
- **准确率**: 80-90%（整体文档），表格识别 75-85%（复杂表格有问题）
- **速度**: 中等（3-8秒/页，取决于 GPU）
- **成本**: 中等（需要 GPU 或高性能 CPU，20GB 磁盘）
- **优势**: 
  - 专门为 LLM 工作流设计
  - 输出 markdown/JSON 格式
  - 整体文档结构解析能力强
- **劣势**: 
  - 表格识别不是强项（官方已知问题）
  - AGPL 许可证限制
  - 资源消耗较大

### 场景 5: 对准确率要求极高，有 GPU 资源
**推荐**: PaddleOCR PP-Structure + MinerU 混合方案
- **准确率**: 85-95%（表格），80-90%（整体文档）
- **速度**: 中等（3-8秒/页）
- **成本**: 中等（需要 GPU）
- **方案**: 
  - MinerU 处理整体文档结构（文本、图片、布局）
  - PaddleOCR PP-Structure 专门处理表格（高准确率）
  - 融合两种结果，取长补短

---

## 硬件要求对比（开源方案）

### CPU vs GPU 性能对比

| 方案 | CPU 支持 | GPU 支持 | CPU 速度 | GPU 速度 | GPU 显存需求 | 推荐配置 |
|------|----------|----------|----------|----------|--------------|----------|
| **pdfplumber** | ✅ 是 | ❌ 否 | ⭐⭐⭐⭐⭐ | - | - | CPU 即可 |
| **Camelot** | ✅ 是 | ❌ 否 | ⭐⭐⭐⭐ | - | - | CPU 即可 |
| **Tabula** | ✅ 是 | ❌ 否 | ⭐⭐⭐⭐ | - | - | CPU 即可 |
| **PaddleOCR PP-Structure** | ✅ 是 | ✅ 是 | ⭐⭐ (1.2秒/页) | ⭐⭐⭐⭐⭐ (0.15秒/页) | **6GB+** | **GPU 推荐** |
| **MinerU** | ⚠️ 可用但慢 | ✅ 是 | ⭐ (很慢) | ⭐⭐⭐ (3-8秒/页) | **8GB+** | **GPU 必需** |
| **Table Transformer** | ⚠️ 可用但慢 | ✅ 是 | ⭐ (很慢) | ⭐⭐ (较慢) | **4GB+** | **GPU 推荐** |

### 详细硬件要求

#### PaddleOCR PP-Structure
- **GPU 模式（推荐）**:
  - 显存: **至少 6GB**（推荐 8GB+）
  - 示例配置: NVIDIA RTX 3090 / RTX 3060 12GB / RTX 4060 Ti 16GB
  - 处理速度: **约 0.15 秒/页**（A4 图片，300DPI）
  - GPU 利用率: 约 70%
  - 性能提升: 比 CPU 快 **8-10 倍**
  
- **CPU 模式（可用）**:
  - CPU: 高性能 CPU（推荐 Intel i9 / AMD Ryzen 9 或更高）
  - 处理速度: **约 1.2 秒/页**（A4 图片，300DPI）
  - CPU 利用率: 接近 100%
  - 适用场景: 
    - 小批量处理（< 100 页/天）
    - 测试和开发环境
    - 无 GPU 资源的生产环境
  - **结论**: CPU 可以运行，但速度较慢，适合小规模使用

#### MinerU
- **GPU 模式（必需）**:
  - 显存: **至少 8GB**（推荐 12GB+）
  - 处理速度: **3-8 秒/页**（取决于 GPU 性能）
  - 磁盘空间: **20GB**（用于模型存储）
  
- **CPU 模式（不推荐）**:
  - 速度: 非常慢（可能 30-60 秒/页）
  - 适用场景: 仅用于测试，不适合生产环境

#### Table Transformer
- **GPU 模式（推荐）**:
  - 显存: **至少 4GB**（推荐 6GB+）
  - 处理速度: 较慢（2-5 秒/页）
  
- **CPU 模式（不推荐）**:
  - 速度: 非常慢，不适合生产环境

### 成本效益分析

#### 方案 1: 纯 CPU 方案（低成本）
- **工具**: pdfplumber + Camelot + Tabula
- **硬件**: CPU 即可（无需 GPU）
- **速度**: 快（< 1 秒/页）
- **准确率**: 75-85%
- **适用**: 简单表格，对速度要求高，预算有限

#### 方案 2: CPU 模式 PaddleOCR（中等成本）
- **工具**: PaddleOCR PP-Structure（CPU 模式）
- **硬件**: 高性能 CPU（无需 GPU）
- **速度**: 中等（1.2 秒/页）
- **准确率**: 85-95%
- **适用**: 对准确率要求高，但无 GPU 资源，可接受较慢速度

#### 方案 3: GPU 模式 PaddleOCR（推荐）
- **工具**: PaddleOCR PP-Structure（GPU 模式）
- **硬件**: GPU（6GB+ 显存）
- **速度**: 快（0.15 秒/页）
- **准确率**: 85-95%
- **适用**: 对准确率和速度都有要求，有 GPU 资源

#### 方案 4: MinerU + PaddleOCR 混合（高成本）
- **工具**: MinerU（GPU）+ PaddleOCR（GPU）
- **硬件**: GPU（12GB+ 显存）
- **速度**: 中等（3-8 秒/页）
- **准确率**: 85-95%（表格），80-90%（整体）
- **适用**: 需要完整文档解析，对准确率要求极高

---

## 技术栈对比

| 方案 | 准确率 | 速度 | 成本 | 中文支持 | 无边框表格 | 扫描件 | 整体解析 | 许可证 |
|------|--------|------|------|----------|------------|--------|----------|--------|
| **pdfplumber** | 70-80% | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐ | MIT |
| **Camelot** | 75-85% | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐ | ⭐⭐ | MIT |
| **Tabula** | 70-80% | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐ | MIT |
| **MinerU** | 80-90% | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | AGPL-3.0 |
| **PaddleOCR PP-Structure** | 85-95% | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | Apache 2.0 |
| **Table Transformer** | 90-95% | ⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | MIT |

---

## 实施建议

### 短期（不改代码）
1. **优化现有参数**: 调整 pdfplumber 和 Camelot 的检测参数
2. **预处理 PDF**: 对扫描件先进行 OCR 和图像增强
3. **手动标注**: 对重要表格手动标注区域

### 中期（小改动）
1. **集成 Tabula**: 增加第三个检测工具，投票机制
2. **优化验证逻辑**: 改进 `_table_has_data()` 函数
3. **添加后处理**: 对检测结果进行后处理和验证

### 长期（大改动）
1. **集成 PaddleOCR PP-Structure**: 用于高准确率场景（专门针对表格）
2. **集成 MinerU**: 用于需要完整文档解析的场景（不仅仅是表格）
3. **混合方案**: 
   - MinerU 处理整体文档（文本、图片、布局）
   - PaddleOCR PP-Structure 专门处理表格（高准确率）
   - 融合两种结果，取长补短
4. **多工具投票机制**: pdfplumber + Camelot + Tabula + PaddleOCR，选择置信度最高的结果

### MinerU 评估 ⭐
**适用场景**:
- ✅ 需要完整文档解析（文本、图片、表格、布局）
- ✅ 需要输出 LLM 就绪格式（markdown/JSON）
- ✅ 有 GPU 资源
- ✅ 可以接受 AGPL 许可证

**不适用场景**:
- ❌ **仅需要表格识别**（MinerU 的表格识别不是强项，官方也承认复杂表格有问题）
- ❌ 商业闭源项目（AGPL 许可证要求衍生作品也开源）
- ❌ 资源受限环境（需要 GPU 和 20GB 磁盘）

**建议**:
- 如果**只需要表格识别**，建议使用 **PaddleOCR PP-Structure**（专门针对表格，准确率更高）
- 如果需要**完整文档解析**（文本+表格+图片+布局），可以考虑 **MinerU**
- 可以**混合使用**：MinerU 处理整体文档，PaddleOCR 专门处理表格

---

## 成本分析

### 传统视觉识别方案（pdfplumber、Camelot、Tabula）
- **开发成本**: 低（集成简单）
- **运行成本**: 低（CPU 即可）
- **维护成本**: 低（工具稳定，更新少）
- **许可证**: MIT（无限制）

### 深度学习方案（PaddleOCR、MinerU、Table Transformer）
- **开发成本**: 高（需要模型集成和调优）
- **运行成本**: 中等（需要 GPU 或高性能 CPU）
- **维护成本**: 中等（模型更新，需要持续优化）
- **许可证**: 
  - PaddleOCR: Apache 2.0（商业友好）
  - MinerU: AGPL-3.0（商业使用需注意）
  - Table Transformer: MIT（无限制）

### 混合方案
- **开发成本**: 高（需要集成多个工具，实现融合逻辑）
- **运行成本**: 中等（需要 GPU）
- **维护成本**: 高（需要维护多个工具和融合逻辑）
- **优势**: 准确率最高（开源方案中）

---

## 结论

### 开源方案总结

#### 表格识别准确率排名（开源方案）
1. **PaddleOCR PP-Structure**: 85-95% ⭐⭐⭐⭐⭐
2. **Table Transformer**: 90-95% ⭐⭐⭐⭐⭐（但需要 GPU，速度慢）
3. **MinerU**: 75-85%（表格不是强项）⭐⭐⭐
4. **Camelot**: 75-85% ⭐⭐⭐⭐
5. **pdfplumber**: 70-80% ⭐⭐⭐
6. **Tabula**: 70-80% ⭐⭐⭐

#### 整体文档解析能力排名（开源方案）
1. **MinerU**: ⭐⭐⭐⭐⭐（专门为 LLM 工作流设计）
2. **PaddleOCR PP-Structure**: ⭐⭐⭐（主要针对表格）
3. **Table Transformer**: ⭐⭐⭐（主要针对表格）
4. **传统工具**: ⭐⭐（仅文本和表格）

#### 推荐方案（开源）
- **仅表格识别**: PaddleOCR PP-Structure（准确率最高，85-95%）
  - **有 GPU**: 使用 GPU 模式（0.15 秒/页，需要 6GB+ 显存）
  - **无 GPU**: 使用 CPU 模式（1.2 秒/页，需要高性能 CPU）
- **完整文档解析**: MinerU（整体解析能力强，需要 GPU，8GB+ 显存）
- **最高准确率**: MinerU + PaddleOCR 混合方案（取长补短，需要 GPU，12GB+ 显存）

#### CPU vs GPU 选择建议
- **PaddleOCR PP-Structure**: 
  - ✅ **CPU 可以运行**，但速度较慢（1.2 秒/页）
  - ✅ **GPU 推荐**，速度快 8-10 倍（0.15 秒/页）
  - 小批量处理（< 100 页/天）可用 CPU
  - 大批量处理建议使用 GPU
- **MinerU**: 
  - ❌ CPU 模式不推荐（非常慢）
  - ✅ GPU 必需（8GB+ 显存）
- **传统工具**（pdfplumber、Camelot、Tabula）: 
  - ✅ CPU 即可，无需 GPU

### 当前方案评估
- **适用场景**: 原生 PDF，简单到中等复杂度的表格
- **准确率**: 70-85%（可优化到 80-90%）
- **优势**: 轻量级，速度快，成本低

### 推荐升级路径（仅开源方案）

#### 路径 A: 专注表格识别
1. **第一步**: 优化现有参数和验证逻辑（当前进行中）
2. **第二步**: 集成 Tabula，实现多工具投票（中期）
3. **第三步**: 集成 PaddleOCR PP-Structure（长期，专门针对表格，准确率 85-95%）

#### 路径 B: 完整文档解析
1. **第一步**: 优化现有参数和验证逻辑（当前进行中）
2. **第二步**: 集成 MinerU（中期，整体文档解析）
3. **第三步**: 集成 PaddleOCR PP-Structure（长期，专门处理表格，与 MinerU 混合使用）

#### 路径 C: 最高准确率（混合方案）
1. **第一步**: 优化现有参数和验证逻辑（当前进行中）
2. **第二步**: 集成 MinerU + PaddleOCR PP-Structure（中期）
3. **第三步**: 实现多工具投票机制（长期，pdfplumber + Camelot + Tabula + PaddleOCR）

### MinerU 评估结论 ⭐
**优点**:
- ✅ 49.4k stars，非常活跃的开源项目
- ✅ 专门为 LLM 工作流设计，输出 markdown/JSON
- ✅ 整体文档解析能力强（文本、图片、布局）
- ✅ 中文支持好，有完整的中文文档
- ✅ 有 Docker 部署方案，易于集成

**缺点**:
- ❌ **表格识别不是强项**（官方已知问题：复杂表格可能出现行列识别错误）
- ❌ AGPL-3.0 许可证（对商业闭源项目有限制）
- ❌ 资源消耗大（需要 GPU，20GB 磁盘空间）
- ❌ 对垂直文本支持有限

**适用性评估**:
- ✅ **适合**: 需要完整文档解析（不仅仅是表格），输出 LLM 就绪格式
- ❌ **不适合**: 仅需要表格识别（建议用 PaddleOCR PP-Structure）
- ❌ **不适合**: 商业闭源项目（许可证限制）

### 最佳实践（仅开源方案）

#### 场景 1: 简单表格，对速度要求高
- **方案**: 当前方案（pdfplumber + Camelot）+ 参数优化
- **准确率**: 75-85%
- **成本**: 低

#### 场景 2: 复杂表格，对准确率要求高
- **方案**: PaddleOCR PP-Structure
- **准确率**: 85-95%
- **硬件选择**:
  - **有 GPU（推荐）**: GPU 模式，6GB+ 显存，速度 0.15 秒/页
  - **无 GPU（可用）**: CPU 模式，高性能 CPU，速度 1.2 秒/页
- **成本**: 
  - GPU 模式: 中等（需要 GPU）
  - CPU 模式: 低（仅需高性能 CPU）

#### 场景 3: 扫描件 PDF
- **方案**: 预处理（OCR + 图像增强）+ PaddleOCR PP-Structure
- **准确率**: 80-90%
- **成本**: 中等

#### 场景 4: 完整文档解析（文本+表格+图片+布局）
- **方案**: MinerU
- **准确率**: 80-90%（整体），75-85%（表格）
- **成本**: 中等（需要 GPU，20GB 磁盘）

#### 场景 5: 最高准确率要求（开源方案）
- **方案**: MinerU + PaddleOCR PP-Structure 混合
  - MinerU 处理整体文档结构
  - PaddleOCR 专门处理表格
  - 融合两种结果
- **准确率**: 85-95%（表格），80-90%（整体）
- **成本**: 中等（需要 GPU）

#### 场景 6: 多工具投票（提高准确率）
- **方案**: pdfplumber + Camelot + Tabula + PaddleOCR
- **准确率**: 80-90%（通过投票机制提高）
- **成本**: 中等（处理时间增加 2-3 倍）

---

## 参考资料

1. **pdfplumber**: https://github.com/jsvine/pdfplumber
2. **Camelot**: https://github.com/camelot-dev/camelot
3. **MinerU**: https://github.com/opendatalab/MinerU (49.4k stars)
4. **PaddleOCR**: https://github.com/PaddlePaddle/PaddleOCR
5. **Table Transformer**: https://github.com/microsoft/table-transformer
6. **Tabula**: https://github.com/tabulapdf/tabula-py

