###############################
# SPX Knowledge Base .env 示例 #
###############################

# 应用
APP_NAME=SPX Knowledge Base
APP_VERSION=1.0.0
DEBUG=true
HOST=0.0.0.0
PORT=8000
ALLOWED_HOSTS=*
ENVIRONMENT=development
SECRET_KEY=replace-with-your-secret
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_FILE=logs/app.log

# 数据库（任选其一：DATABASE_URL 或分项配置）
DATABASE_URL=mysql+pymysql://user:password@localhost:3306/spx_knowledge
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=user
MYSQL_PASSWORD=password
MYSQL_DATABASE=spx_knowledge

# Redis
REDIS_URL=redis://localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# OpenSearch
OPENSEARCH_URL=http://localhost:9200
OPENSEARCH_USERNAME=
OPENSEARCH_PASSWORD=
OPENSEARCH_USE_SSL=false
OPENSEARCH_VERIFY_CERTS=false

# MinIO
MINIO_ENDPOINT=localhost:9000
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_BUCKET_NAME=spx-knowledge-base
MINIO_SECURE=false

# 嵌入/向量模型（本地 Ollama 示例）
OLLAMA_BASE_URL=http://192.168.131.158:11434
OLLAMA_MODEL=llama2
OLLAMA_EMBEDDING_MODEL=nomic-embed-text
# QA对话历史总结模型（可选，如果为 None 或空字符串，则使用问答模型 OLLAMA_MODEL）
# 建议使用更小的模型以提高总结效率，例如：llama2:7b 或 qwen2:7b
QA_SUMMARY_MODEL=None

# 图像嵌入/CLIP（如未使用可保留默认）
IMAGE_EMBEDDING_MODEL=clip_vit_b32
CLIP_MODEL_NAME=ViT-B-32
# 可选：如需修改模型缓存目录
# CLIP_MODELS_DIR=./models/clip
# CLIP_PRETRAINED_PATH=./models/clip/ViT-B-32-openclip.pt
# CLIP_CACHE_DIR=./models/clip/cache
# OCR / Qwen VL (使用 Ollama)
OCR_ENGINE=qwen_vl
OCR_MAX_RETRIES=1
OCR_RETRY_DELAY_SECONDS=0
OCR_PREPROCESS_ENABLED=true
OCR_PREPROCESS_MAX_SIZE=2048
OCR_PREPROCESS_DENOISE=false
OLLAMA_OCR_MODEL=qwen2-vl:7b
# 如需单独部署 OCR Ollama，可覆盖此项；留空复用 OLLAMA_BASE_URL
OLLAMA_OCR_BASE_URL=
OLLAMA_OCR_TIMEOUT=120
OLLAMA_OCR_MAX_RETRIES=2
# Rerank 模型（默认在 models/rerank 目录）
# RERANK_MODEL_NAME=BAAI/bge-reranker-v2-m3
# RERANK_MODEL_PATH=./models/rerank
# 可选：Hugging Face 缓存目录（默认使用 ~/.cache/huggingface）
# HF_HOME=~/.cache/huggingface

# 多模态与阈值（根据需要调整，保留默认即可）
MULTIMODAL_TEXT_MAX_LENGTH=10000
MULTIMODAL_IMAGE_MAX_SIZE_MB=10
MULTIMODAL_IMAGE_MAX_DIMENSION=1024
MULTIMODAL_MAX_KEYWORDS=10
MULTIMODAL_DEFAULT_FUSION_SCORE=0.8
MULTIMODAL_DEFAULT_SEMANTIC_SIMILARITY=0.7
MULTIMODAL_DEFAULT_RELEVANCE_SCORE=0.7
MULTIMODAL_DEFAULT_CONSISTENCY_SCORE=0.8

# 历史/检索（可保持默认）
QA_DEFAULT_PAGE_SIZE=20
QA_MAX_PAGE_SIZE=100
QA_DEFAULT_SIMILARITY_THRESHOLD=0.7
QA_DEFAULT_MAX_SOURCES=10
QA_DEFAULT_MAX_HISTORY=5
QA_DEFAULT_MAX_RESULTS=10
QA_HISTORY_INDEX_NAME=qa_history
QA_HISTORY_CLEANUP_DAYS=90
QA_HISTORY_DEFAULT_PAGE_SIZE=20
QA_HISTORY_MAX_PAGE_SIZE=100
QA_ANSWER_INDEX_NAME=qa_answers
# 搜索历史限制
SEARCH_HISTORY_DEFAULT_LIMIT=5
SEARCH_HISTORY_MAX_LIMIT=20

# 向量维度/文本限制
TEXT_EMBEDDING_DIMENSION=1024
IMAGE_EMBEDDING_DIMENSION=512
TEXT_EMBED_MAX_CHARS=1024

# 文件/安全
FILE_HEADER_READ_SIZE=1024
MAX_FILE_SIZE=104857600
# 仅 DOCX（与 settings 保持一致）
ALLOWED_FILE_TYPES=.docx,.pdf,.txt,.log

# 文档处理参数
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
# 最小分块大小：避免产生太多小块（默认 500 字符，约为 CHUNK_SIZE 的一半）
# 如果分块小于此值，会尝试与相邻分块合并（合并后不超过 chunk_max）
CHUNK_MIN_SIZE=500
MAX_CHUNKS_PER_DOCUMENT=1000
PARSING_TIMEOUT=300
VECTORIZATION_TIMEOUT=600
OLLAMA_TIMEOUT=300
STORE_CHUNK_TEXT_IN_DB=false

# LibreOffice（若未设置，程序会尝试自动查找 soffice/libreoffice 命令）
SOFFICE_PATH=

# ClamAV（如不使用可保留默认）
CLAMAV_ENABLED=true
CLAMAV_REQUIRED=false
CLAMAV_SOCKET_PATH=
CLAMAV_TCP_HOST=localhost
CLAMAV_TCP_PORT=3310
CLAMAV_SCAN_TIMEOUT=60
CLAMAV_USE_TCP=false

# 缓存
CACHE_TTL_SECONDS=3600
CACHE_MAX_SIZE=1000
CACHE_CLEANUP_INTERVAL=300

# Celery Worker 配置
# Celery worker 并发数（默认根据 CPU 数自动计算，建议 >= 4 以避免 k8s 同步任务占用）
# 如果 CPU 核心数 >= 4，默认使用 4-8 个并发；否则使用 2-4 个并发
# 设置为空表示自动计算，也可以手动指定（如 6、8 等）
CELERY_CONCURRENCY=
# Celery worker 监听的队列（默认包含所有队列）
# 如果 OBSERVABILITY_ENABLE_SCHEDULE 为 False，默认排除 observability 队列
# 设置为空表示使用默认值（根据 OBSERVABILITY_ENABLE_SCHEDULE 决定）
# 也可以手动指定，如：document,vector,index,image,version,cleanup,notification,celery
CELERY_QUEUES=

# 批量上传配置
ENABLE_BATCH_SECURITY_SCAN_QUEUE=true

# 自动重试配置
ENABLE_AUTO_RETRY=false
AUTO_RETRY_MAX_RETRIES=3
AUTO_RETRY_INTERVAL_SECONDS=300
AUTO_RETRY_BATCH_SIZE=10
# Celery 日志级别
CELERY_LOG_LEVEL=INFO

# Celery 任务优先级配置（0-255，数字越大优先级越高）
# 文档处理任务（最高优先级）
CELERY_TASK_PRIORITY_DOCUMENT=10
# 向量化任务
CELERY_TASK_PRIORITY_VECTOR=8
# 索引任务
CELERY_TASK_PRIORITY_INDEX=8
# 图片处理任务
CELERY_TASK_PRIORITY_IMAGE=7
# 版本任务
CELERY_TASK_PRIORITY_VERSION=6
# 通知任务
CELERY_TASK_PRIORITY_NOTIFICATION=5
# K8s 同步任务（低优先级，后台任务）
CELERY_TASK_PRIORITY_OBSERVABILITY=3
# 清理任务（最低优先级）
CELERY_TASK_PRIORITY_CLEANUP=2
# 默认优先级
CELERY_TASK_PRIORITY_DEFAULT=5

# 观测平台 / Kubernetes
OBSERVABILITY_RESOURCE_TYPES=pods,deployments,statefulsets
OBSERVABILITY_DEFAULT_NAMESPACE=
OBSERVABILITY_SYNC_INTERVAL_SECONDS=300
OBSERVABILITY_HEALTHCHECK_INTERVAL_SECONDS=600
OBSERVABILITY_METRICS_CACHE_SECONDS=120
OBSERVABILITY_LOG_CACHE_SECONDS=60
OBSERVABILITY_ENABLE_SCHEDULE=true
OBSERVABILITY_ALLOWED_ROLES=admin
OBSERVABILITY_WATCH_TIMEOUT_SECONDS=30
OBSERVABILITY_WATCH_MAX_ATTEMPTS=3
OBSERVABILITY_DIAGNOSIS_MAX_ITERATIONS=5
OBSERVABILITY_DIAGNOSIS_CONFIDENCE_THRESHOLD=0.8
OBSERVABILITY_DIAGNOSIS_MEMORY_RECENT_LIMIT=10
OBSERVABILITY_DIAGNOSIS_ITERATION_DELAY_SECONDS=5
SEARXNG_URL=
EXTERNAL_SEARCH_ENABLED=true
EXTERNAL_SEARCH_MIN_DOC_HITS=2
EXTERNAL_SEARCH_MIN_SCORE=0.55
EXTERNAL_SEARCH_MIN_CONFIDENCE=0.6
EXTERNAL_SEARCH_RESULT_LIMIT=5
EXTERNAL_SEARCH_CACHE_TTL=600
EXTERNAL_SEARCH_RATE_LIMIT_PER_USER=30
EXTERNAL_SEARCH_RATE_LIMIT_WINDOW=3600
EXTERNAL_SEARCH_TIMEOUT=12
EXTERNAL_SEARCH_SUMMARY_ENABLED=true
EXTERNAL_SEARCH_SUMMARY_MAX_ITEMS=5
EXTERNAL_SEARCH_SUMMARY_MODEL=
EXTERNAL_SEARCH_INDEX_NAME=external_searches
EXTERNAL_SEARCH_CATEGORIES=
EXTERNAL_SEARCH_INTENT_MODEL=


